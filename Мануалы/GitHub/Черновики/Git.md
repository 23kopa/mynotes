### Рекомендуемый рабочий процесс:

1. **Разработка на локальной машине:**
    
    - Разработку стоит начинать на локальной машине. Ты можешь писать и тестировать код локально, а затем синхронизировать изменения с сервером через Git.
        
    - После того как ты завершил часть разработки или протестировал её локально, коммитишь и пушишь изменения в репозиторий.
        
2. **Использование Git для синхронизации с сервером:**
    
    - На сервере ты клонируешь репозиторий и регулярно обновляешь его с помощью `git pull`. Это позволяет серверу работать с последними изменениями из репозитория.
        
    - Вместо того чтобы разрабатывать прямо на сервере, лучше клонировать репозиторий и работать с ним, как с удаленным хранилищем.
***
#### Создание SSH-ключа:
```
ssh-keygen -t rsa -b 4096 -C "tw44400@gmail.com"
```
***
#### Публикация или внос изменений:

```sh
git add . # Добавляем директорию
git status # Статус
git commit -m "Добавлен код Telegram-бота" # Коммит
git push origin main # Публикация на главной ветке
```
#### Удаление:
```sh
# Удаляем файлы
git status # Статус
git add -u
git commit -m "Удален файл test3" # Коммит
git push origin main # Публикация на главной ветке
```
***
#### Ручная загрузка на сервер
```sh
git pull
```
***
#### Автоматическая загрузка на сервер
```sh
nano /root/TG-Bots/my_bot/update_and_restart.sh
```

```sh
#!/bin/bash

cd /root/TG-Bots/my_bot || exit

# Подтягиваем последние изменения
git pull origin main

# Перезапускаем systemd-сервис
systemctl restart mybot
```

```sh
crontab -e
```

```sh
*/5 * * * * /root/TG-Bots/my_bot/update_and_restart.sh >> /root/TG-Bots/my_bot/cron.log 2>&1
```
***
```sh
git remote add origin git@github.com:23kopa/mybot.git
```

```sh
git remote -v
#origin  git@github.com:23kopa/mybot.git (fetch)
#origin  git@github.com:23kopa/mybot.git (push)
```
***

***
#### Разворачивание:
```sh
git clone git@github.com:23kopa/mybot.git
cd mybot
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt  # если у тебя есть такой файл
```
***
#### No push

```sh
root@kopa:~/TG-Bots/my_bot# git remote -v
origin  git@github.com:23kopa/mybot.git (fetch)
origin  git@github.com:23kopa/mybot.git (push)
root@kopa:~/TG-Bots/my_bot# git remote set-url --push origin no_push
root@kopa:~/TG-Bots/my_bot# git remote -v
origin  git@github.com:23kopa/mybot.git (fetch)
origin  no_push (push)
```

***
#### Запуск сервиса

Чтобы сохранить текущую версию бота в репозитории и иметь возможность вернуться к ней в будущем, тебе нужно создать **тег** или **ветку** в Git. Это позволит зафиксировать текущую версию кода, и ты всегда сможешь вернуться к этому состоянию, даже если в будущем что-то пойдет не так.
***
```
sudo nano /etc/systemd/system/mybot.service
```

```
[Unit]
Description=My Telegram Bot
After=network.target

[Service]
User=root
WorkingDirectory=/root/TG-Bots/my_bot
ExecStart=/root/TG-Bots/my_bot/my_venv/bin/python main.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

```
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl enable mybot
sudo systemctl start mybot
```
***
### Бэкапы
#### Создание тега

Тег в Git — это способ маркировки конкретного коммита, обычно для важной версии проекта (например, "версия 1.0").

1. Чтобы создать тег, открой терминал в директории проекта и используй следующую команду:
    
    bash
    
    КопироватьРедактировать
    
    `git tag -a v1.0 -m "Сохранена версия 1.0 бота"`
    
    Это создаст тег с именем `v1.0` и комментарием "Сохранена версия 1.0 бота". Ты можешь выбрать любое имя для тега.
    
2. После этого нужно запушить тег на GitHub:
    
    bash
    
    КопироватьРедактировать
    
    `git push origin v1.0`
    

Теперь эта версия будет зафиксирована в репозитории, и ты всегда сможешь вернуться к ней.

Чтобы вернуться к тегу:

bash

КопироватьРедактировать

`git checkout v1.0`

#### Создание ветки

Ветка — это более гибкий способ работы с кодом. Ты можешь создать новую ветку, зафиксировать текущую версию и в дальнейшем работать с ней, не затрагивая основную ветку.

1. Чтобы создать новую ветку и переключиться на неё:
    
    bash
    
    КопироватьРедактировать
    
    `git checkout -b backup-branch`
    
2. После этого зафиксируй все изменения и запушь новую ветку в репозиторий:
    
    bash
    
    КопироватьРедактировать
    
    `git add . git commit -m "Создана ветка для сохранения текущего состояния" git push origin backup-branch`
    

Теперь у тебя будет ветка, в которой сохранено текущее состояние, и ты всегда сможешь вернуться к ней, если потребуется.

Чтобы вернуться к ветке:

bash

КопироватьРедактировать

`git checkout backup-branch`

#### Когда нужно вернуться к сохраненному состоянию

1. Чтобы вернуться к последнему состоянию из ветки или тега, используй команду:
    
    bash
    
    КопироватьРедактировать
    
    `git checkout v1.0  # если вернулся к тегу git checkout backup-branch  # если вернулся к ветке`
    

#### Советы

- **Теги** удобны для сохранения "релизных" версий, когда ты хочешь зафиксировать некий стабильный момент.
    
- **Ветки** подходят, если ты хочешь продолжить работу в параллельной версии кода, сохраняя при этом основную ветку неизменной.
    

С помощью этих методов ты сможешь безопасно работать с проектом, не переживая о потерянных данных или ошибках в коде.

Если ты обновишь бота и захочешь сделать текущую версию "исходным стартовым состоянием", ты можешь выполнить следующие шаги:

1. **Добавь изменения в индекс:** Если ты обновил бота, но не добавил изменения в индекс Git, сделай это с помощью команды:
    
    bash
    
    КопироватьРедактировать
    
    `git add .`
    
2. **Сделай коммит:** После того как изменения добавлены в индекс, сделай коммит с описанием того, что изменилось:
    
    bash
    
    КопироватьРедактировать
    
    `git commit -m "Обновлена версия бота, сохранено стартовое состояние"`
    
3. **Запушь изменения в ветку `backup-branch`:** Запушь коммит в ветку, которую ты использовал для сохранения текущего состояния:
    
    bash
    
    КопироватьРедактировать
    
    `git push origin backup-branch`
    

Теперь, если тебе нужно будет вернуться к этой версии в будущем, ты можешь просто переключиться на ветку `backup-branch`, и твой бот будет в том состоянии, которое ты сохранил.

#### Как вернуться к сохраненному состоянию:

Если ты захочешь вернуться к этой версии в будущем, просто выполните:

bash

КопироватьРедактировать

`git checkout backup-branch`

Эта команда переключит тебя на ветку `backup-branch`, где сохранена текущая версия бота.

Если ты решишь, что эта версия бота должна стать основной (например, после обновлений), ты можешь слить ветку `backup-branch` в `main` (или любую другую основную ветку):

bash

КопироватьРедактировать

`git checkout main git merge backup-branch git push origin main`

Таким образом, ты сможешь поддерживать стабильные версии и всегда иметь возможность вернуться к предыдущим состояниям.